## Задача: фикc прайсинга Uniswap V3

1. **Сбор артефактов**
   - Снять текущие значения `SPXWETH`/`SPXUSD` из Redis и логов V3, зафиксировать аномалию.
   - Определить адрес пулов (из конфигурации) и реальные стейты через RPC.

2. **Анализ цепочки расчёта**
   - Проследить обработку Swap в `internal/dex/Etherium/Uniswap/connect_uniswap_v3_all.go`: формирование цены, нормализация decimals, вызов прайсера.
   - Проверить, как формируются `TokenInfo`, какие decimals/порядок токенов используются, что передаётся в `UpdatePair`.

3. **Сверка с эталоном**
   - На примере `SPX/WETH` и пары к стейблу вручную пересчитать цену (sqrtPriceX96 → price или reserves) и сравнить с результатом коннектора.
   - Выявить, на каком этапе появляется неверная величина (decimals, инверсия, порядок токенов, маршрут).

4. **Формулировка исправления**
   - Определить минимальные изменения: корректировка нормализации, пересчёта цены, весов или вызова прайсера.
   - Проверить, не затрагивает ли фикс существующие V2/другие DEX коннекторы.

5. **Реализация**
   - Внести правку в код (V3 коннектор/прайсер), минимизируя влияние на общий пайплайн.
   - Добавить регрессионный тест (unit/integration) для кейса с дробными decimals/inverted токенами.

6. **Валидация**
   - `go test ./...` либо таргетный пакет.
   - Запустить коннектор (локально) и убедиться, что `SPXUSD` → ~1.x и другие проблемные пулы также корректны.

7. **Документация/лог**
   - Обновить `docs/project_documentation.md`/README при необходимости (описание V3 расчётов/особенностей).
   - Зафиксировать изменения/observations в заметках проекта.

---
